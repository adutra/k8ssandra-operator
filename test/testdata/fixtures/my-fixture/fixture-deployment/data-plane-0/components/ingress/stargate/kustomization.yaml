apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

patches:

  - target:
      group: traefik.containo.us
      version: v1alpha1
      kind: IngressRoute
      name: stargate-service-http-ingress
    patch: |-
      - op: replace
        path: /metadata/name
        value: "cluster1-dc1-stargate-service-http-ingress"
        
      - op: replace
        path: /spec/routes/0/match
        value: "HostRegexp(`stargate.my-fixture.{ip:[0-9\\.]+}.nip.io`) && PathPrefix(`/v1/auth`)"
      - op: replace
        path: /spec/routes/1/match
        value: "HostRegexp(`stargate.my-fixture.{ip:[0-9\\.]+}.nip.io`) && (PathPrefix(`/graphql-schema`) || PathPrefix(`/graphql/`) || PathPrefix(`/playground`))"
      - op: replace
        path: /spec/routes/2/match
        value: "HostRegexp(`stargate.my-fixture.{ip:[0-9\\.]+}.nip.io`) && PathPrefix(`/v2/`)"
        
      - op: replace
        path: /spec/routes/0/services/0/name
        value: "cluster1-dc1-stargate-service"
      - op: replace
        path: /spec/routes/1/services/0/name
        value: "cluster1-dc1-stargate-service"
      - op: replace
        path: /spec/routes/2/services/0/name
        value: "cluster1-dc1-stargate-service"

  - target:
      group: traefik.containo.us
      version: v1alpha1
      kind: IngressRouteTCP
      name: stargate-service-native-ingress
    patch: |-
      - op: replace
        path: /metadata/name
        value: "cluster1-dc1-stargate-service-native-ingress"
      - op: replace
        path: /spec/routes/0/services/0/name
        value: "cluster1-dc1-stargate-service"
